---
title: 暗号化したファイルをgit diffする
tags:
  - Git
  - command
  - shell
private: false
updated_at: '2025-12-04T19:15:25+09:00'
id: 243d59cb99d9fca625da
organization_url_name: null
slide: false
ignorePublish: false
---
Gitで管理しているファイルを暗号化しておきたい場合があるが,
`git diff`してももちろん以下のように中身は出力されない.

```console
$ git diff
Binary files a/foo.gpg and b/foo.gpg differ
```

中身を見たいのであれば, 以下のように設定が必要.
例として, ここでは, __GnuPG__ を使う.

まず, 以下のように, 復号化する[フィルタ](https://git-scm.com/docs/git-diff#Documentation/git-diff.txt-diffltdrivergttextconv)を設定する. [^1]

[^1]: `-o`は出力ファイルを指定するオプションで, 指定先の`-`は標準出力という意味なので,
      `-o-`で復号化内容を標準出力に出力ということになる.


```console
$ git config --global diff.gpg.textconv 'gpg -o-'
```

そうすると, `~/.gitconfig`に以下のような行が追加されている.

```~/.gitconfig
[diff "gpg"]
textconv = gpg -o-
```

このフィルタを`*.gpg`に適用したい場合は, [`.gitattributes`](https://git-scm.com/docs/gitattributes#_performing_text_diffs_of_binary_files)に以下の行を追加する.

```:.gitattributes
*.gpg diff=gpg
```

以上の設定をした上で, `git diff`をすると, `*.gpg`のファイルに変更があるときに限り,
以下のように2回パスフレーズの入力を求められる. [^2]

[^2]: これはそれぞれ変更前と後のファイルを復号化するパスフレーズ入力に対応している.

```console
$ git diff
Enter passphrase:
Enter passphrase:
```

パスフレーズを入力すると,  復号化され, `git diff`で見ることができる.

`git grep`も[`--textconv`](https://git-scm.com/docs/git-grep#Documentation/git-grep.txt---textconv)オプションを付けると, パスフレーズの入力を求められ, 見ることができる.

```console
$ git grep --textconv WORD
Enter passphrase:
```


## 参考

https://git-scm.com/docs/gitattributes#_performing_text_diffs_of_binary_files

http://qiita.com/skkzsh/items/bf873227bd8184b26bcf

http://qiita.com/skkzsh/items/6b8c3eea4395a9c87d76

