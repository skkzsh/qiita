---
title: PowerShellやバッチファイルで管理者特権をチェック
tags:
  - Windows
  - bat
  - コマンドプロンプト
  - PowerShell
private: false
updated_at: '2025-12-04T19:04:57+09:00'
id: 5e03bb7792629927acfa
organization_url_name: null
slide: false
ignorePublish: false
---
PowerShellやバッチファイルで,
「__管理者として実行__」したかどうかを判定する例文は下記の通り.

## PowerShell

```powershell
if (([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole(`
        [Security.Principal.WindowsBuiltInRole] "Administrator")) {
    Write-Output "管理者として実行しました. シンボリック・リンクの作成を試みます. "
    CMD /C MKLINK /D "$Env:HOME\.emacs.d" "$Env:USERPROFILE\Dropbox\.emacs.d"
}

else {
    Write-Warning "管理者として実行していません. シンボリック・リンクの作成はできません. "
    exit 1
}
```

:::note
ifの条件式が長いので, 文末の`(バッククォート)により,
条件式を複数行に分けて書いていることに注意. 
:::

### 参考

https://devblogs.microsoft.com/scripting/check-for-admin-credentials-in-a-powershell-script/


## バッチファイル

```powershell
NET SESSION > NUL 2>&1
IF %ERRORLEVEL% == 0 (
    ECHO 管理者として実行しました. シンボリック・リンクの作成を試みます.
    MKLINK /D %HOME%\.emacs.d %USERPROFILE%\Dropbox\.emacs.d
) ELSE (
    ECHO 管理者として実行していません. シンボリック・リンクの作成はできません. >&2
    EXIT /B 1
)
```

:::note
NET SESSIONは本来の用途ではなく, 単に管理者特権の有無の判定に使用されている.
よって, NET SESSIONでなくとも, 管理者特権が必要なコマンドであれば良いようだ.
:::

### 参考

http://stackoverflow.com/questions/4051883/batch-script-how-to-check-for-admin-rights/11995662

