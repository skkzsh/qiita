---
title: Drone CIでのcron設定 (画面とコマンドと)
tags:
  - CI
  - drone.io
private: false
updated_at: '2025-12-04T19:25:30+09:00'
id: 9e906b3135a89912f43a
organization_url_name: null
slide: false
ignorePublish: false
---
## はじめに

- Droneでのcron設定は, 公式ドキュメントを含めてインターネットに情報が少ないため, 調べたことを書く
- Droneでのcron設定は, ハマりポイントがあるため, 注意を書き残す
- 確認バージョン: 1.9.1

## cron追加方法

:::note
画面, コマンド, APIの3種類ある.
:::
- **画面**からだと, 実行周期のタイミングが5種類 (`@hourly`, `@daily`, `@monthly`, `@weekly`, `@yearly`) のみ
- **コマンド**からだと, 一般的なcron形式 (`0 */30 * * * *` とか) を使える
- **API**からのやり方は, ここでは割愛する

### 画面からのcron追加

![drone_cron_ly.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/6361/16659b58-bb52-cc14-f066-fb916d5bb1b5.png)

1. cronを追加したいリポジトリを選択
1. 「**Settings**」タブを選択
1. 「**Cron Jobs**」で「**Cron Job Name**」「**Cron Job Branch**」を入力. 実行周期を選択
1. 「**Add A CRON JOB**」を押下
1. 「**Cron Jobs**」で追加した設定が確認できたらOK

### コマンドからのcron追加
#### 事前準備
##### drone CLIをインストール

以下の公式を参照

https://docs.drone.io/cli/install

##### Personal Tokenを設定
1. 右上の自分のアイコンから「**User Settings**」をクリック

1. 「**Your Personal Token**」で自分のトークンを控える.
「**Example CLI Usage**」に記載のように環境変数を設定する.

```sh
export DRONE_SERVER=https://example.drone.skkzsh.me
export DRONE_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

#### コマンドからのcron追加 (例)

https://docs.drone.io/cli/cron/

以下, リポジトリやcron名, 実行周期などは, 読み替えてください. 

```sh
drone cron ls skkzsh/app
 
drone cron add skkzsh/app nightly "0 */30 * * * *" --branch develop
 
drone cron ls skkzsh/app
drone cron info skkzsh/app nightly
```

画面でも「**Settings**」→「**Cron Jobs**」で追加した設定が確認できる.

## cron削除方法

:::note warn
コマンドで削除はできないため, 画面から消す
:::

## drone.ymlの書き方
- 公式情報を参照

## 注意ポイント

https://docs.drone.io/server/reference/drone-cron-interval/

:::note warn
Droneはデフォルトでは1時間ごとしかcron jobを確認しないらしい. 
そのため, 実行周期を10分ごとに設定しても1時間ごとに実行される.
:::

:::note warn
Droneは実行時刻を保証しない. 何分に設定しても, 00分に実行される. 
そのため, 設定値より最大1時間, 実行遅延が発生する可能性がある.
:::

::: note warn
タイムゾーンは JST (日本時間) でなく, UTCのため, cronの設定時刻に注意.
:::

## 公式情報

https://docs.drone.io/cron/
